<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Status - Bethel College</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea 0,#764ba2 100%); min-height:100vh; display:flex; align-items:center; justify-content:center; margin:0 }
        .status-card { background:white; border-radius:12px; padding:28px; width:100%; max-width:720px; box-shadow:0 20px 40px rgba(0,0,0,0.08) }
        .btn-primary-small { padding:6px 10px; font-size:0.95rem }
    </style>
</head>
<body>
    <div class="status-card">
        <h4><i class="fas fa-file-alt me-2"></i>Check Application Status</h4>
        <p class="text-muted">Enter the Application ID provided after submission or use the link you received by email.</p>

        <div class="mb-3">
            <label for="appIdInput" class="form-label">Application ID</label>
            <div class="d-flex">
                <input id="appIdInput" class="form-control me-2" placeholder="Paste your application ID" />
                <button id="checkBtn" class="btn btn-custom btn-primary-small">Check</button>
            </div>
        </div>

        <div id="statusResult" style="display:none; margin-top:12px"></div>

        <hr>
        <div class="d-flex justify-content-between">
            <a href="apply-now.html" class="btn btn-secondary">New Application</a>
            <a href="mailto:admissions@bethel.edu" class="btn btn-outline-secondary">Contact Admissions</a>
        </div>
    </div>

    <script>
        const statusResult = document.getElementById('statusResult');
        const appIdInput = document.getElementById('appIdInput');
        const checkBtn = document.getElementById('checkBtn');

        async function fetchStatus(id) {
            if (!id) return;
            statusResult.style.display = 'block';
            statusResult.innerHTML = '<div class="alert alert-info">Checking status&hellip;</div>';
            try {
                const res = await fetch(`https://school-management-api-zeta-two.vercel.app/api/applications/${encodeURIComponent(id)}/status`, { method: 'GET', headers: { 'Content-Type': 'application/json' } });
                const data = await res.json();
                if (res.ok) {
                    statusResult.innerHTML = `\n                        <div class="alert alert-success">\n                            <h5>Status: ${data.status}</h5>\n                            <p><strong>Submitted:</strong> ${data.submissionDate ? new Date(data.submissionDate).toLocaleString() : 'N/A'}</p>\n                            <p><strong>Remarks:</strong> ${data.remarks || 'None'}</p>\n                        </div>`;
                } else {
                    statusResult.innerHTML = `<div class="alert alert-danger">${data.message || 'Application not found'}</div>`;
                }
            } catch (err) {
                console.error('Error fetching status', err);
                statusResult.innerHTML = '<div class="alert alert-danger">Network error while checking status.</div>';
            }
        }

        checkBtn.addEventListener('click', () => fetchStatus(appIdInput.value.trim()));

        // If page has ?id=... in URL, auto-check
        const params = new URLSearchParams(window.location.search);
        const idFromUrl = params.get('id');
        if (idFromUrl) {
            appIdInput.value = idFromUrl;
            fetchStatus(idFromUrl);
        }

    </script>
</body>
</html>
